<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<AutomationSequence documentVersion="1.0">
  <!-- Specify macros here -->
<!--   <Macros>
    <Macro Name="mods_resMods_folders" Value="res_mods"/>
  </Macros> -->

  <!-- Specify the tasks to run -->
  <TaskDefinitions>
    <!-- import tasks / retrieve devurl -->
    <Task ID="import_macro_create_tasks" Command="import_task" RepoUrlPath="Task_templates/macro_create_work_dirs.xml"/>
    <Task ID="get_download_url" Command="retrieve_package_property" PropertyName="DevURLList" TargetPackageUID="this" MacroSaveName="download_url" PropertyIndex="0"/>

    <!-- download the source and modpack -->
    <Task ID="download_xvm_latest_zip" Command="download_static" Url="{download_url}" DestinationPath="{working_folder_source}\{packageName}.zip"/>
    <Task ID="download_modpack" Command="package_download" FilePath="{working_folder_modpack}\{packageName}.zip"/>
    
      <!-- extract the source and modpack wotmod files-->
    <Task ID="extract_source" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="x {last_download_filename}.zip"/>
    <!-- 'e' means to extract (to the work direcotry, without using the zip file's paths), and -r means to recurse into the zip folder's directories -->
    <Task ID="extract_modpack" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_modpack}" Cmd="x {packageName}.zip"/>
        
    <!-- DELETE DIRECTORIES FROM MODPACK-PKG / NO COMPARE -->
    <Task ID="delete_files_modpack_1" Command="delete_directory" DirectoryPath="{working_folder_modpack}\mods"/>
    <Task ID="delete_files_modpack_2" Command="delete_directory" DirectoryPath="{working_folder_modpack}\res_mods"/>
      
    <!-- IN SOURCE-PKG: DELETE UNECESSARY FILES AND FOLDERS  -->
    <!-- xvm_latest.zip\readme-cz.txt  -->
    <!-- xvm_latest.zip\readme-en.txt  -->
    <!-- xvm_latest.zip\readme-fr.txt  -->
    <!-- xvm_latest.zip\readme-pl.txt  -->
    <!-- xvm_latest.zip\readme-ru.txt  -->
    <!-- xvm_latest.zip\res_mods\1.13.0.1 (folder)  -->
    <!-- xvm_latest.zip\res_mods\configs\xvm\sirmax (folder) -->
    <!-- xvm_latest.zip\res_mods\configs\xvm\configs.url --> 
    <!-- xvm_latest.zip\res_mods\configs\xvm\xvm.xc.sample -->
    <Task ID="delete_files_source_1" Command="delete_file" DirectoryPath="{working_folder_source}\readme-cz.txt"/>
    <Task ID="delete_files_source_2" Command="delete_file" DirectoryPath="{working_folder_source}\readme-en.txt"/>
    <Task ID="delete_files_source_3" Command="delete_file" DirectoryPath="{working_folder_source}\readme-fr.txt"/>
    <Task ID="delete_files_source_4" Command="delete_file" DirectoryPath="{working_folder_source}\readme-pl.txt"/>
    <Task ID="delete_files_source_5" Command="delete_file" DirectoryPath="{working_folder_source}\readme-ru.txt"/>
    <Task ID="delete_files_source_6" Command="delete_file" DirectoryPath="{working_folder_source}\res_mods\configs\xvm\configs.url"/>
    <Task ID="delete_files_source_7" Command="delete_file" DirectoryPath="{working_folder_source}\res_mods\configs\xvm\xvm.xc.sample"/>
    <Task ID="delete_files_source_8" Command="delete_directory" DirectoryPath="{working_folder_source}\res_mods\1.13.0.1"/>
    <Task ID="delete_files_source_9" Command="delete_directory" DirectoryPath="{working_folder_source}\res_mods\configs\xvm\sirmax"/>
     
    <!-- IN SOURCE-PKG: get the current version of the mod from filename -->
    <!-- xvm_latest.zip\8.8.1_0043 -->
    
    <!-- IN SOURCE-PKG: RENAME {clientVersion} TO versiondir --> 
    
    <!-- COPY ALL FILES FROM SOURCE TO MODPACK-PKG -->   
    <!-- Update modpack files -->
    <Task ID="update_modpack" Command="file_copy" SourceFilePath="{working_folder_source}" DestinationFilePath="{working_folder_modpack}"/>
    <!-- DUPLICATE FOLDER *\res_mods\configs\xvm\default TO *\res_mods\configs\xvm\default_backup -->
    <Task ID="update_modpack" Command="file_copy" SourceFilePath="{working_folder_source}\res_mods\configs\xvm\default" DestinationFilePath="{working_folder_modpack}\res_mods\configs\xvm\default_backup"/>
    <Task ID="extract_modpack" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_modpack}" Cmd="{7z_create_package_zipfile}"/>

    <!-- upload to the server -->
    <Task ID="upload_zip" Command="package_upload" FilePath="{working_folder_modpack}\final.zip" ZipFileName="{packageName}_{clientVersion}_{date}.zip"/>
  </TaskDefinitions>

</AutomationSequence>