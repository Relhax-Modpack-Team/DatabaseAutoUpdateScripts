<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<AutomationSequence documentVersion="1.0">
    <Macros>
        <Macro Name="github_direct_url" Value="https://github.com/Relhax-Modpack-Team/WGClanIconDownload/releases/download/1.0.0.0/WoTClanIconDownloadConsole.exe"/>
    </Macros>
    <TaskDefinitions>
        <!--  Fetch source and ftp  -->
        <Task ID="create_workdir_source_macro" Command="macro_create" MacroName="working_folder_source" MacroValue="{workDirectory}"/>
        <Task ID="download_mod_source" Command="download_static" Url="{github_direct_url}" DestinationPath="{workDirectory}\WoTClanIconDownloadConsole.exe"/>
        <!-- Tasks to create icons -->
        <Task ID="run_clanicons_program" Command="shell_exec" Filename="{workDirectory}\WoTClanIconDownloadConsole.exe" Wd="{workDirectory}" Cmd="/debug /apiLoadLimit 80 /concurrentConnectionsPerRegion 35 /concurrentApiRequestsPerRegion 3 /regionsToDownload eu" />
        <!-- Tasks to create zips -->
        <Task ID="create_zip" Command="shell_exec" Filename="7z.exe" Wd="{workDirectory}\download\EU" Cmd="a -tzip -mx9 -r XVMConfigBuilder_ClanIcons_EU_{clientVersion}_{date}.zip res_mods" />
        <!-- upload to the server -->
        <Task ID="loadDB" Command="load_database" />
        <Task ID="upload_zip" Command="package_upload" FilePath="{workDirectory}\EU\XVMConfigBuilder_ClanIcons_EU_{clientVersion}_{date}.zip" ZipFileName="{packageName}_{clientVersion}_{date}.zip"/>
        <!-- tasks to update packageValues -->
        <Task ID="updatePackageDate" Command="update_package_property" PropertyName="Version" PropertyValue="{date}" /> 
    </TaskDefinitions>
</AutomationSequence>