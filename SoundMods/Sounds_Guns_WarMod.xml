<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<AutomationSequence documentVersion="1.0">
  <!-- Specify macros here -->
  <Macros>
  </Macros>

  <!-- Specify the tasks to run -->
  <TaskDefinitions>
  
    <!-- import tasks -->
    <Task ID="import_macro_create_tasks" Command="import_task" RepoUrlPath="Task_templates/create_workDirs_macros.xml"/>
    
    
    <Task ID="import_macro_getdlurl" Command="import_task" RepoUrlPath="Task_templates/getDownloadUrl_THISindex0.xml"/>
    <Task ID="import_macro_create_tasks" Command="import_task" RepoUrlPath="Task_templates/downloadSourceBrowser_WGMods.xml"/>
    
    <Task ID="import_macro_create_tasks" Command="import_task" RepoUrlPath="Task_templates/downloadModpack_PackageNameZip.xml"/>
    
    <!-- extract the source and modpack wotmod files-->
    <Task ID="extract_source1" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_source}\mods\versiondir&quot; GunssoundMod.wotmod -r"/>
    <Task ID="extract_source2" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\versiondir&quot; Surface_HitssoundMod.wotmod -r"/>
    <Task ID="extract_source3" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\versiondir&quot; ReloadsoundMod.wotmod -r"/>
    <Task ID="extract_source4" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\versiondir&quot; HitssoundMod.wotmod -r"/>
    <Task ID="extract_source5" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\versiondir&quot; TracersoundMod.wotmod -r"/>
    
    <Task ID="extract_source1" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\configs\PYmods\SoundEventInjector\configs&quot; Gun_effects.json -r"/>
    <Task ID="extract_source2" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\configs\PYmods\SoundEventInjector\configs&quot; Guns.json -r"/>
    <Task ID="extract_source3" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\configs\PYmods\SoundEventInjector\configs&quot; Hits.json -r"/>
    <Task ID="extract_source4" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\configs\PYmods\SoundEventInjector\configs&quot; Reload.json -r"/>
    <Task ID="extract_source5" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\configs\PYmods\SoundEventInjector\configs&quot; Surface_hits.json -r"/>
    <Task ID="extract_source6" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="e {last_download_filename} -o&quot;{working_folder_package}\mods\configs\PYmods\SoundEventInjector\configs&quot; Tracer.json -r"/>
    


    <!-- 'e' means to extract (to the work direcotry, without using the zip file's paths), and -r means to recurse into the zip folder's directories -->
    <Task ID="extract_modpack1" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_modpack}" Cmd="x {packageName}.zip GunssoundMod.wotmod -r"/>
    <Task ID="extract_modpack2" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_modpack}" Cmd="e {packageName}.zip -o&quot;{working_folder_package}\_patch&quot; Dependency_Sounds_Guns_WarMod_bnk_NoGun*SoundBnk_Patch.xml -r"/>
    <Task ID="extract_modpack3" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_modpack}" Cmd="e {packageName}.zip -o&quot;{working_folder_package}\_patch&quot; Dependency_Sounds_Guns_WarMod_audioModsXML_patch.xml -r"/>
    <Task ID="extract_modpack4" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_modpack}" Cmd="e {packageName}.zip -o&quot;{working_folder_package}\_patch&quot; Dependency_Sounds_Guns_WarMod_Gun*SoundBnk_Patch.xml -r"/>


    <Task ID="compare_start" Command="compare_start"/>
    <!-- Compare wotmod and config file -->
    <Task ID="compare_wotmod" Command="file_compare"
      FileA="{working_folder_source}\mods\versiondir\GunssoundMod.wotmod"
      FileB="{working_folder_modpack}\mods\versiondir\GunssoundMod.wotmod"/>
    <Task ID="compare_end" Command="compare_end"/>


    <!-- if the comparison is good, meaning there is an update, then we want to copy the source into a new 'final' folder and upload -->
    <Task ID="create_source_dir_post_compare" Command="create_directory" DirectoryPath="{workDirectory}\package\mods\versiondir"/>
    <Task ID="move_source_post_compare" Command="file_copy" SourceFilePath="{working_folder_source}\mods\versiondir\GunssoundMod.wotmod" DestinationFilePath="{workDirectory}\package\mods\versiondir\GunssoundMod.wotmod"/>


    <Task ID="create_zip" Command="shell_exec" Filename="7z.exe" Wd="{workDirectory}\package" Cmd="{7z_createFinalZip}"/>


    <!-- upload to the server -->
    <Task ID="upload_zip" Command="package_upload" FilePath="{workDirectory}\package\final.zip" ZipFileName="{packageName}_{clientVersion}_{date}.zip"/>
  
  
  
  </TaskDefinitions>

</AutomationSequence>