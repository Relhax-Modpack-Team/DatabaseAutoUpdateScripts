<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<AutomationSequence documentVersion="1.0">
  <!-- Specify macros here -->
  <Macros>
    <Macro Name="clientVersionMan" Value="1.14.0.0 Common Test"/>
  </Macros>
  <TaskDefinitions>
  
  
    <!-- Create macros. Working folders for source and modpack versions, and get the 0th index devUrl -->
    <Task ID="create_workdir_source_macro" Command="macro_create" MacroName="working_folder_source" MacroValue="{workDirectory}\source"/>
    <Task ID="create_workdir_modpack_macro" Command="macro_create" MacroName="working_folder_modpack" MacroValue="{workDirectory}\modpack"/>
    <Task ID="create_workdir_package_macro" Command="macro_create" MacroName="working_folder_package" MacroValue="{workDirectory}\package"/>

    <!-- Create the working directories -->
    <Task ID="create_directory_source" Command="create_directory" DirectoryPath="{working_folder_source}"/>
    <Task ID="create_directory_modpack" Command="create_directory" DirectoryPath="{working_folder_modpack}"/>
    <Task ID="create_directory_package" Command="create_directory" DirectoryPath="{working_folder_package}"/>
    

    <!-- download the source zip file, which *could* implicitly creates the directories, if we didn't define them first -->
    <Task ID="get_download_url" Command="retrieve_package_property" PropertyName="DevURLList" TargetPackageUID="this" MacroSaveName="download_url" PropertyIndex="0"/>
    <Task ID="download_mod_source" Command="download_static" Url="{download_url}" DestinationPath="{working_folder_source}\{last_download_filename}"/>
    
    <!-- download current modpack zip file -->
    <!-- <Task ID="download_modpack" Command="package_download" FilePath="{working_folder_modpack}\{packageName}.zip"/> -->

    <!-- extract source files-->
    <Task ID="extract_source" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_source}" Cmd="x {last_download_filename} * -r"/>

    <!-- get the source version of the mod by file name -->
    <Task ID="get_filename" Command="directory_search" DirectoryPath="{working_folder_source}" SearchPath="?.?.?_????" Recursive="False" MacroPrefix="get_filename_results"/>
    <Task ID="get_modVersion_source" Command="macro_create" MacroName="modVersion_source" MacroValue="{get_filename_results_0}"/>
    <!-- get modpack version from version field in database -->
    <Task ID="get_modVersion_modpack" Command="macro_create" MacroName="modVersion_modpack" MacroValue="{version}"/>

    
    <!-- extract modpack - the versionfile only -->
    <!-- <Task ID="extract_modpack" Command="shell_exec" Filename="7z.exe" Wd="{working_folder_modpack}" Cmd="x {packageName}.zip *.*.*_**** -r -x!com.*"/> -->
    <!-- <Task ID="clear_modpack_downloadedZip" Command="file_delete" SourceFilePath="{working_folder_modpack}\{packageName}.zip"/> -->
    
    <!-- EDIT SOURCE -->
        <!-- DELETE UNECESSARY FILES AND FOLDERS  -->
    <Task ID="delete_files_source_1" Command="file_delete" SourceFilePath="{working_folder_source}\readme-cz.txt"/>
    <Task ID="delete_files_source_2" Command="file_delete" SourceFilePath="{working_folder_source}\readme-en.txt"/>
    <Task ID="delete_files_source_3" Command="file_delete" SourceFilePath="{working_folder_source}\readme-fr.txt"/>
    <Task ID="delete_files_source_4" Command="file_delete" SourceFilePath="{working_folder_source}\readme-pl.txt"/>
    <Task ID="delete_files_source_5" Command="file_delete" SourceFilePath="{working_folder_source}\readme-ru.txt"/>
    <Task ID="delete_files_source_6" Command="file_delete" SourceFilePath="{working_folder_source}\res_mods\configs\xvm\configs.url"/>
    <Task ID="delete_files_source_7" Command="file_delete" SourceFilePath="{working_folder_source}\res_mods\configs\xvm\xvm.xc.sample"/>
    <Task ID="delete_files_source_8" Command="file_delete" SourceFilePath="{working_folder_source}\{modVersion_source}"/>
    <Task ID="delete_resModsClientVersionFolder_source" Command="directory_delete" DirectoryPath="{working_folder_source}\res_mods\{clientVersionMan}\"/>
    <!-- <Task ID="delete_SirmaxCfgFolder_source" Command="file_delete" SourceFilePath="{working_folder_source}\res_mods\configs\xvm\sirmax\*.*"/> -->
    <Task ID="delete_SirmaxCfgFolder_source2" Command="directory_delete" DirectoryPath="{working_folder_source}\res_mods\configs\xvm\sirmax"/>
    
    
    
    <!-- i want "directory_copy" and "directory_delete" to run properly first befrore i finish this -->
    
    
    
    
    <!-- <Task ID="copyDefCfg" Command="directory_copy" DirectoryPath="{working_folder_source}\res_mods\configs\xvm\default" SearchPath="*.*" Recursive="True" DestinationPath="{working_folder_source}\res_mods\configs\xvm\default_backup"/> -->
    
    
    
    
    
    
    <!-- TMP START -->
    <!-- TMP START -->
    
    
    
    <!-- Update modpack files -->
    <!-- <Task ID="update_modpack" Command="directory_copy" DirectoryPath="{working_folder_source}\mods" DestinationFilePath="{working_folder_package}"/> -->
    <!-- <Task ID="update_modpack2" Command="directory_copy" DirectoryPath="{working_folder_source}\res_mods" DestinationFilePath="{working_folder_package}"/> -->
    
    


    <!-- Create the wotmod names -->
    <!-- <Task ID="create_wotmod_source_macro" Command="macro_create" MacroName="wotmod_source" MacroValue="{wotmod_name}_{mod_version_2}.wotmod"/> -->
    <!-- <Task ID="create_wotmod_modpack_macro" Command="macro_create" MacroName="wotmod_modpack" MacroValue="{wotmod_name}_{version}.wotmod"/> -->


    <!-- <Task ID="compare_start" Command="compare_start"/> -->
    <!-- Compare wotmod and config file -->
    <!-- <Task ID="compare_wotmod" Command="file_compare" -->
      <!-- FileA="{working_folder_source}\mods\{clientVersionMan}\{wotmod_source}" -->
      <!-- FileB="{working_folder_modpack}\mods\versiondir\{wotmod_modpack}"/> -->
    <!-- <Task ID="compare_end" Command="compare_end"/> -->

    <!-- if the comparison is good, meaning there is an update, then we want to copy the source into a new 'final' folder and upload -->
    <!-- <Task ID="create_source_dir_post_compare" Command="create_directory" DirectoryPath="{workDirectory}\package\mods\versiondir"/> -->
    <!-- <Task ID="move_source_post_compare" Command="file_copy" SourceFilePath="{working_folder_source}\mods\{clientVersionMan}\{wotmod_source}" DestinationFilePath="{workDirectory}\package\mods\versiondir\{wotmod_source}"/> -->
    <!-- <Task ID="move_source_post_compare2" Command="file_copy" SourceFilePath="{working_folder_source}\mods\configs\CHAMPi\safeShotPro\safeShotPro.json" DestinationFilePath="{workDirectory}\package\mods\configs\CHAMPi\safeShotPro\safeShotPro.json"/> -->
    <!-- <Task ID="move_source_post_compare4" Command="file_copy" SourceFilePath="{working_folder_source}\mods\configs\CHAMPi\safeShotPro\i18n\de.json" DestinationFilePath="{workDirectory}\package\mods\configs\CHAMPi\safeShotPro\i18n\de.json"/> -->
    <!-- <Task ID="move_source_post_compare5" Command="file_copy" SourceFilePath="{working_folder_source}\mods\configs\CHAMPi\safeShotPro\i18n\en.json" DestinationFilePath="{workDirectory}\package\mods\configs\CHAMPi\safeShotPro\i18n\en.json"/> -->
    <!-- <Task ID="move_source_post_compare6" Command="file_copy" SourceFilePath="{working_folder_source}\mods\configs\CHAMPi\safeShotPro\i18n\pl.json" DestinationFilePath="{workDirectory}\package\mods\configs\CHAMPi\safeShotPro\i18n\pl.json"/> -->



    <!-- TMP END -->
    <!-- TMP END -->
    
    
    


    <!-- create the new zip -->
    <!-- <Task ID="create_zip" Command="shell_exec" Filename="7z.exe" Wd="{workDirectory}\source" Cmd="{7z_createFinalZip}"/> -->
    
<!-- update version field in database - [LogicalDependency_XVM_Main_Nightly] and [XVMconfigBuilder_BuildSelector_Nightly] -->
    <!-- <Task ID="update_package_version" Command="update_package_property" PropertyName="Version" PropertyValue="{modVersion_source}" TargetPackageUID="vxb6fqgbg3p0hfv9" /> -->
    <!-- <Task ID="update_package_version" Command="update_package_property" PropertyName="Version" PropertyValue="{modVersion_source}" TargetPackageUID="8rzkblqj805kg3lj" /> -->

    <!-- upload to the server -->
    <!-- <Task ID="upload_zip" Command="package_upload" FilePath="{workDirectory}\package\final.zip" ZipFileName="{packageName}_v{modVersion_source}_{clientVersion}_{date}.zip"/> -->

  </TaskDefinitions>
</AutomationSequence>